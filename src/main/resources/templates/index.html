<!DOCTYPE html>
<html lang="en-GB" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>GHKG - Home</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7T+LnbwGd2e1z5zZh1HcZd9I0gUksdQRVox" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h1 class="text-center mb-4">Welcome to GHKG App</h1>

    <ul class="list-group mb-4">
        <li class="list-group-item"><a href="/login">Login Page</a></li>
        <li class="list-group-item" id="meLink" style="display: none;"><a href="/me">User Info</a></li>
        <li class="list-group-item" id="adminLink" style="display: none;"><a href="/admin">Admin Panel</a></li>
        <li class="list-group-item"><a href="/garage">Garage</a></li>
        <li class="list-group-item"><a href="/trips">Trips</a></li>
        <li class="list-group-item"><a href="/swagger-ui/index.html" target="_blank">Swagger UI</a></li>
    </ul>

    <footer class="text-muted text-center">
        <p>Version: <span th:text="${version}">unknown</span></p>
    </footer>
</div>

<script>
    const token = localStorage.getItem("token");

    if (token) {
        document.getElementById("meLink").style.display = "list-item";
        document.getElementById("loginLink").style.display = "none";

        const authActions = document.getElementById("authActions");
        const logoutBtn = document.createElement("button");
        logoutBtn.textContent = "Logout";
        logoutBtn.onclick = function () {
            localStorage.removeItem("token");
            window.location.href = "/";
        };
        authActions.appendChild(logoutBtn);

        fetch("/api/me", {
            headers: {
                "Authorization": "Bearer " + token
            }
        })
            .then(response => {
                if (!response.ok) {
                    console.warn("Token seems invalid or expired.");
                    return null;
                }
                return response.json();
            })
            .then(data => {
                if (!data) return;

                const roles = data.roles || [];
                if (roles.includes("ADMIN")) {
                    document.getElementById("adminLink").style.display = "list-item";
                }
            })
            .catch(err => {
                console.error("Error fetching user info:", err);
            });
    }
</script>


</body>
</html>
