<!DOCTYPE html>
<html lang="en-GB" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>GHKG - Home</title>
    <meta charset="UTF-8"/>
</head>
<body>
<h1>Welcome to GHKG App</h1>

<ul>
    <li><a href="/login">Login Page</a></li>
    <li id="meLink" style="display: none;"><a href="/me">User Info</a></li>
    <li id="adminLink" style="display: none;"><a href="/admin">Admin Panel</a></li>
    <li><a href="/garage">Garage</a></li>
    <li><a href="/trips">Trips</a></li>
    <li><a href="/swagger-ui/index.html" target="_blank">Swagger UI</a></li>
</ul>

<hr>
<p>Version: <span th:text="${version}">unknown</span></p>

<script>
    const token = localStorage.getItem("token");

    if (token) {
        document.getElementById("meLink").style.display = "list-item";

        fetch("/me", {
            headers: {
                "Authorization": "Bearer " + token
            }
        })
            .then(response => {
                if (!response.ok) throw new Error("Unauthorized");
                return response.json();
            })
            .then(data => {
                const roles = data.roles || [];
                if (roles.includes("ADMIN")) {
                    document.getElementById("adminLink").style.display = "list-item";
                }
            })
            .catch(() => {
                localStorage.removeItem("token");
            });
    }
</script>


</body>
</html>
